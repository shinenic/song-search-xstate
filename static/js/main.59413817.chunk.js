(this["webpackJsonpsong-search-xstate"]=this["webpackJsonpsong-search-xstate"]||[]).push([[0],{49:function(e,t,n){e.exports=n.p+"static/media/loading.0f51771c.svg"},50:function(e,t,n){e.exports=n.p+"static/media/search.fa72ba04.svg"},51:function(e,t,n){e.exports=n.p+"static/media/cross.4f744e82.svg"},52:function(e,t,n){e.exports=n(63)},57:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n.n(a),o=n(40),c=n.n(o),i=(n(57),n(14)),s=n(30),u=n(11),l=n(47),d=n(32),f=n(6),g={menu:{initial:"closed",states:{closed:{on:{TOGGLE_MENU:{target:"opened",actions:Object(f.q)("DISABLE_SEARCH_BOX")}}},opened:{on:{TOGGLE_MENU:{target:"closed",actions:Object(f.q)("ENABLE_SEARCH_BOX")}}}}}},h={searchBox:{initial:"enable",states:{enable:{on:{CHANGE_INPUT:[{cond:"withResultOnly",actions:["cleanInput","cleanResult",Object(f.q)("TOGGLE_IDLE")]},{cond:"shouldSkipDebounce",actions:["setInput","setKeyword",Object(f.q)("VERIFY_PARAMS")]},{actions:["setInput","setKeyword",Object(f.q)("SEARCH_WITH_DEBOUNCE")]}],TOGGLE_CLEAN:[{cond:"withInput",actions:"cleanInput"},{cond:"withResultOnly",actions:["cleanResult",Object(f.q)("TOGGLE_IDLE")]}],DISABLE_SEARCH_BOX:"disable"}},disable:{on:{ENABLE_SEARCH_BOX:"enable"}}}}},b=Object(i.a)(Object(i.a)(Object(i.a)({},{result:{initial:"idle",on:{TOGGLE_IDLE:{target:".idle"},SEARCH_WITH_DEBOUNCE:{target:".searchBuffer"},FETCH_MORE:{actions:"setPage",target:".verifyingParams"},VERIFY_PARAMS:{target:".verifyingParams"}},states:{idle:{},searchBuffer:{entry:["cancelSearch","sendSearchEventAfterDelay"]},verifyingParams:{on:{"":[{target:"idle",cond:"invalidParams"},{target:"searching"}]}},searching:{entry:["setLoading","setNoError"],exit:["setLoaded"],invoke:{id:"fetch-result",src:"fetchResult",onDone:[{target:"noResult",cond:"isNoResult"},{target:"showResult",actions:"setResult"}],onError:{target:"errorResult",actions:"setError"}}},errorResult:{on:{RETRY:{target:"searching"}}},noResult:{type:"final"},showResult:{type:"final"}}}}),h),g),p=(n(25),function(e){return e.replace(/[\r\n\s]/g,"")}),m=function(e){return/[\u3105-\u3129\u02CA\u02C7\u02CB\u02D9]/.test(e)},v=function(e){return Object(u.isString)(e)&&Object(u.isEmpty)(e)},E=function(e){return Object(u.isArray)(e)&&Object(u.isEmpty)(e)},O={shouldSkipDebounce:function(e,t){return t.skipDebounce||!1},withInput:function(e){return!v(e.input)},withResultOnly:function(e,t){return!E(e.result)&&(v(e.input)||v(t.input))},invalidParams:function(e){return v(e.input)||m(Object(u.last)(e.input.trim()))},isNoResult:function(e,t){return E(Object(u.get)(t,["data","songs","result"],[]))||!Object(u.get)(t,["data","songs","result"])}},w=n(35),j=n(18).actions.cancel,y={setInput:Object(f.b)({input:function(e,t){return t.input||""}}),cleanInput:Object(f.b)({input:""}),cleanResult:Object(f.b)({result:[]}),setResult:Object(f.b)({result:function(e,t){return Object(u.get)(t,["data","songs","pagination","currentPage"],1)>1?[].concat(Object(w.a)(e.result),Object(w.a)(Object(u.get)(t,["data","songs","result"],[]))):Object(u.get)(t,["data","songs","result"],[])},pagination:function(e,t){return Object(u.get)(t,["data","songs","pagination"],{})}}),setLoading:Object(f.b)({loading:!0}),setLoaded:Object(f.b)({loading:!1}),setNoError:Object(f.b)({error:null}),setError:Object(f.b)({error:function(e,t){return t.data||!0}}),setKeyword:Object(f.b)({variables:function(e,t){return{keyword:p(t.input||""),page:1}}}),setPage:Object(f.b)({variables:function(e,t){return Object(i.a)(Object(i.a)({},e.variables),{},{page:t.page||1})}})},R={sendSearchEventAfterDelay:Object(f.q)("VERIFY_PARAMS",{delay:100,id:"debounced-search"}),cancelSearch:j("debounced-search")},_=Object(i.a)(Object(i.a)({},y),R),C=n(29),L=new(n(17).a),N=new C.a({uri:"https://zhuo-zhu-api.kadenzwei.com/graphql",cache:L}),k=n(46);function A(){var e=Object(k.a)(["\n  query Songs($keyword: String, $page: Int) {\n    songs(keyword: $keyword, page: $page) {\n      result {\n        title\n        artist\n        volume\n        page\n      }\n      pagination {\n        totalCount\n        pageSize\n        totalPages\n        currentPage\n      }\n    }\n  }\n"]);return A=function(){return e},e}var S=Object(C.b)(A()),x={fetchResult:function(e,t){return new Promise((function(n,a){N.query({query:S,variables:e.variables,fetchPolicy:t.retry?"network-only":"cache-first"}).then((function(e){e.errors&&a(e.errors),n(e.data)}))}))}},I=Object(d.a)({id:"ZhuoZhuSearch",context:{input:"",result:[],pagination:{},loading:!1,error:null,variables:{keyword:"",page:1}},type:"parallel",states:b},{actions:_,guards:O,services:x}),T=Object(a.createContext)(),P=function(){return Object(a.useContext)(T)},B=function(e){var t=e.children,n=Object(l.useMachine)(I),a=Object(s.a)(n,2),o=a[0],c=a[1];return r.a.createElement(T.Provider,{value:function(){var e=o.context;return Object(i.a)({state:o,send:c,context:e,searchKeywordLoading:e.loading&&1===Object(u.get)(e,["variables","page"],1),fetchMoreLoading:e.loading&&1!==Object(u.get)(e,["variables","page"],1)},{sendChangeInput:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c({type:"CHANGE_INPUT",input:e,skipDebounce:t})},sendToggleClean:function(){return c("TOGGLE_CLEAN")},sendFetchMore:function(e){return c({type:"FETCH_MORE",page:e})},sendRetry:function(){return c({type:"RETRY",retry:!0})}})}()},t)},D=function(){return r.a.createElement("div",{className:"idle-result"},"Please enter something to search.")},G=function(){return r.a.createElement("div",{className:"no-result"},"Nothing found.")},H=function(){var e=P().sendRetry;return r.a.createElement("div",{className:"error-result"},"An error occurred, please\xa0",r.a.createElement("span",{className:"error-result__retry",onClick:e},"try again"),".")},q=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){var n=null,a=0,r=t.current,o=function(t){var r=(new Date).getTime(),o=r-a;clearTimeout(n),o>0&&o<450?(e(),t.preventDefault()):n=setTimeout((function(){clearTimeout(n)}),450),a=r};return r.addEventListener("click",o),function(){r.removeEventListener("click",o)}})),t},M=r.a.memo((function(e){var t,n=e.song,a=e.searchArtist,o=q((function(){var e=n.title,t=n.artist;!function(e,t){window.confirm('\u9023\u7d50\u81f3Youtube\u641c\u5c0b "'.concat(e,'" '))&&window.open("https://www.youtube.com/results?search_query=".concat(t),"_blank").focus()}(e,"".concat(e,"+").concat(t.replace(/[/+]/gi,"+")))})),c=q((function(){return a(n.artist)})),i={artist:""===(t=n).artist||"XXX"===t.artist?"-":t.artist.replace(/[/+]/gi,"\n"),position:""===t.volume?Number(t.page):"".concat(Number(t.volume),"/").concat(Number(t.page)),title:t.title},s=i.title,u=i.artist,l=i.position;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"row__title",ref:o},s),r.a.createElement("div",{className:"row__artist",ref:c},u),r.a.createElement("div",{className:"row__position"},l))})),W=n(34),U=n.n(W),F=n(48),X=function(e){var t=Object(a.useState)(e),n=Object(s.a)(t,2),r=n[0],o=n[1],c=Object(a.useRef)(Object(u.debounce)(Object(F.a)(U.a.mark((function e(){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o(!1);case 1:case"end":return e.stop()}}),e)}))),1500));return Object(a.useEffect)((function(){e?o(!0):c.current()}),[e]),{showLoading:r,setShowLoading:o}},Y=n(49),K=n.n(Y),$=r.a.memo((function(e){var t=e.isLoading;return r.a.createElement("div",{className:"fetch-more-loading"},r.a.createElement("img",{src:K.a,alt:"icon",className:"fetch-more-loading__icon"+(t?"":" hide")}))})),z=r.a.memo((function(e){var t=e.isLoading;return r.a.createElement("div",{className:"loading-container"},r.a.createElement("div",{className:t?"loading-bar":""}))})),V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;Object(a.useEffect)((function(){var n=function(){window.innerHeight+window.pageYOffset>=document.body.offsetHeight-t&&e()};return window.addEventListener("scroll",n),function(){window.removeEventListener("scroll",n)}}))},J=function(){var e=P(),t=e.context,n=e.searchKeywordLoading,o=e.fetchMoreLoading,c=e.sendFetchMore,i=e.sendChangeInput,s=Object(a.useCallback)((function(e){i(e,!0)}),[]);V((function(){var e=t.pagination,n=e.currentPage;n<e.totalPages&&c(n+1)}));var u=X(n).showLoading;return r.a.createElement("div",null,r.a.createElement(z,{isLoading:u}),t.result.map((function(e){return r.a.createElement(M,{key:"".concat(e.title).concat(e.volume).concat(e.page),song:e,searchArtist:s})})),r.a.createElement($,{isLoading:o}))},Z=function(){var e=P().state.value.result;return"idle"===e?r.a.createElement(D,null):"errorResult"===e?r.a.createElement(H,null):"noResult"===e?r.a.createElement(G,null):r.a.createElement(J,null)},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;Object(a.useEffect)((function(){var n=function(n){e&&!e.current.contains(n.target)&&t()};return document.addEventListener("mousedown",n),document.addEventListener("touchstart",n),function(){document.removeEventListener("mousedown",n),document.removeEventListener("touchstart",n)}}),[e,t])},ee=function(){var e=P(),t=e.context,n=e.sendChangeInput,r=e.sendToggleClean,o=Object(a.useRef)(null),c=Object(a.useRef)(null);return Q(c,(function(){o.current.blur()})),{inputText:t.input,inputRef:o,searchBoxRef:c,handleOnChange:function(e){n(e.target.value),function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.scrollTo({top:0,behavior:e?"smooth":"auto"})}()},handleClearBtnClick:function(){r()},showSearchIcon:E(t.result)&&v(t.input),handleSearchBtnClick:function(){o.current.focus()}}},te=n(50),ne=n.n(te),ae=n(51),re=n.n(ae),oe=function(){var e=ee(),t=e.inputText,n=e.inputRef,a=e.searchBoxRef,o=e.handleOnChange,c=e.handleClearBtnClick,i=e.showSearchIcon,s=e.handleSearchBtnClick;return r.a.createElement("div",{className:"search-box",ref:a},r.a.createElement("input",{className:"search-box__input",type:"text",placeholder:"Title / Artist / Volume",value:t,ref:n,onChange:o}),i?r.a.createElement("img",{src:ne.a,alt:"icon",className:"search-box__icon search-box__icon--search",onClick:s}):r.a.createElement("img",{src:re.a,alt:"icon",className:"search-box__icon search-box__icon--cross",onClick:c}))},ce=function(){return r.a.createElement("div",{className:"main"},r.a.createElement("div",{className:"search-page-placeholder"}),r.a.createElement(oe,null),r.a.createElement(Z,null))},ie=n(66),se=function(){return r.a.createElement(ie.a,{client:N},r.a.createElement(B,null,r.a.createElement(ce,null)))},ue=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function le(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(se,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/song-search-xstate",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/song-search-xstate","/service-worker.js");ue?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):le(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):le(t,e)}))}}()}},[[52,1,2]]]);
//# sourceMappingURL=main.59413817.chunk.js.map